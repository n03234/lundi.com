{% extends 'layout.html' %}
{% block content %}
  <h2>投稿を編集</h2>
  <form action="/edit/{{ post['id'] }}" method="post" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <label>カテゴリ:
      <select name="category" required>
        <option value="food_photo" {% if post['category']=='food_photo' %}selected{% endif %}>ご飯の写真</option>
        <option value="shop_intro" {% if post['category']=='shop_intro' %}selected{% endif %}>お店の紹介</option>
        <option value="recipe_intro" {% if post['category']=='recipe_intro' %}selected{% endif %}>レシピ紹介</option>
      </select>
    </label>
    <label>店舗サブカテゴリ（店舗紹介時のみ）:
      <select name="shop_category">
        <option value="">-- 選択 --</option>
        <option {% if post['shop_category']=='和食' %}selected{% endif %}>和食</option>
        <option {% if post['shop_category']=='洋食' %}selected{% endif %}>洋食</option>
        <option {% if post['shop_category']=='中華' %}selected{% endif %}>中華</option>
        <option {% if post['shop_category']=='カフェ' %}selected{% endif %}>カフェ</option>
        <option {% if post['shop_category']=='居酒屋' %}selected{% endif %}>居酒屋</option>
        <option {% if post['shop_category']=='ラーメン' %}selected{% endif %}>ラーメン</option>
        <option {% if post['shop_category']=='スイーツ' %}selected{% endif %}>スイーツ</option>
      </select>
    </label>
    <fieldset class="shop-details">
      <legend>店舗詳細（店舗紹介時のみ）</legend>
      <label>店名: <input name="shop_name" value="{{ post['shop_name'] or '' }}" maxlength="200"></label>
      <label>住所: <input name="shop_address" value="{{ post['shop_address'] or '' }}" maxlength="200"></label>
      <label>URL: <input name="shop_url" value="{{ post['shop_url'] or '' }}" maxlength="300" placeholder="https://..."></label>
      <label>営業時間: <input name="shop_hours" value="{{ post['shop_hours'] or '' }}" maxlength="200" placeholder="例: 11:00-22:00"></label>
      <label>電話番号: <input name="shop_phone" value="{{ post['shop_phone'] or '' }}" maxlength="200"></label>
      <label>価格帯: <input name="shop_price_range" value="{{ post['shop_price_range'] or '' }}" maxlength="200" placeholder="例: 1000-2000円"></label>
      <input type="hidden" name="shop_lat" id="shop_lat" value="{{ post['shop_lat'] or '' }}">
      <input type="hidden" name="shop_lng" id="shop_lng" value="{{ post['shop_lng'] or '' }}">
    </fieldset>

    <script>
      (function() {
        const catSel = document.querySelector('select[name="category"]');
        const nameInput = document.querySelector('input[name="shop_name"]');
        const addrInput = document.querySelector('input[name="shop_address"]');
        function updateGeo() {
          if (catSel.value === 'shop_intro' && navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
              const lat = pos.coords.latitude;
              const lng = pos.coords.longitude;
              const latInput = document.getElementById('shop_lat');
              const lngInput = document.getElementById('shop_lng');
              if (latInput && lngInput && !latInput.value && !lngInput.value) {
                latInput.value = lat;
                lngInput.value = lng;
              }
            }, function(err){
              console.log('geolocation error', err);
            }, {enableHighAccuracy: 
