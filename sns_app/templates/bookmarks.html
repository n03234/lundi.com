{% extends 'layout.html' %}
{% block content %}
  <h2>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</h2>
  {% if premium %}
    <form action="/bookmarks" method="get" class="bm-sort" style="margin-bottom:8px">
      <label>ä¸¦ã³æ›¿ãˆ:
        <select name="sort">
          <option value="position" {% if sort=='position' %}selected{% endif %}>æ‰‹å‹•ï¼ˆä¿å­˜é †ï¼‰</option>
          <option value="created_desc" {% if sort=='created_desc' %}selected{% endif %}>æ–°ã—ã„é †</option>
          <option value="created_asc" {% if sort=='created_asc' %}selected{% endif %}>å¤ã„é †</option>
          <option value="likes_desc" {% if sort=='likes_desc' %}selected{% endif %}>ã„ã„ã­ãŒå¤šã„é †</option>
          <option value="category" {% if sort=='category' %}selected{% endif %}>ã‚«ãƒ†ã‚´ãƒª</option>
        </select>
      </label>
      <button type="submit">é©ç”¨</button>
    </form>
  {% else %}
    <p>é«˜åº¦ãªä¸¦ã³æ›¿ãˆã‚„æ•´ç†ã¯ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼ˆæœˆé¡300å††ï¼‰ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚<a href="/pricing">è³¼èª­ã™ã‚‹</a></p>
  {% endif %}

  <section class="feed">
    {% for p in bookmarks %}
      <article class="post">
        <div class="post-header">
          {% if p['avatar'] %}
            <img class="avatar-img" src="{{ url_for('static', filename='uploads/avatars/' ~ p['avatar']) }}" alt="avatar">
          {% else %}
            <div class="avatar">{{ p['username'][:1]|upper }}</div>
          {% endif %}
          <div>
            <div><a href="/user/{{ p['username'] }}">{{ p['username'] }}</a> <span class="badge">{% if p['category']=='food_photo' %}ã”é£¯ã®å†™çœŸ{% elif p['category']=='shop_intro' %}ãŠåº—ã®ç´¹ä»‹{% elif p['category']=='recipe_intro' %}ãƒ¬ã‚·ãƒ”ç´¹ä»‹{% else %}ãã®ä»–{% endif %}</span></div>
            <div class="meta">{{ p['created_at'] }}</div>
          </div>
        </div>
        {% if premium %}
          <div class="bm-tools" style="margin:8px 0; display:flex; align-items:center; gap:8px">
            <a href="/bookmarks/move/{{ p['id'] }}?dir=up">â¬†ï¸ ä¸Šã¸</a>
            <a href="/bookmarks/move/{{ p['id'] }}?dir=down">â¬‡ï¸ ä¸‹ã¸</a>
            <form action="/bookmarks/folder/{{ p['id'] }}" method="post" style="display:inline-flex; align-items:center; gap:4px">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <input name="folder" value="{{ p['folder'] or '' }}" placeholder="ãƒ•ã‚©ãƒ«ãƒ€å" maxlength="40">
              <button type="submit">ä¿å­˜</button>
            </form>
          </div>
        {% endif %}
        <p class="content">{{ p['content'] }}</p>
        {% if p['image'] %}
          {% set thumb_path = 'uploads/thumbs/thumb_' + p['image'] %}
          {% set full_path = 'uploads/' + p['image'] %}
          <div class="post-image"><a href="{{ url_for('static', filename=full_path) }}" target="_blank"><img src="{{ url_for('static', filename=thumb_path) }}" alt="image" style="max-width:320px"></a></div>
        {% endif %}
        <div class="post-actions">
          <form action="/bookmark/{{ p['id'] }}" method="post" class="bm-form" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">ğŸ”– è§£é™¤</button>
          </form>
        </div>
      </article>
    {% else %}
      <p>ã¾ã ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
  </section>
{% endblock %}
